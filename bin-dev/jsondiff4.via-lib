#!/bin/bash

basedir="$(dirname "$0")/.."

export JQ_STACK4_MODDIR="$basedir/lib"
. "$basedir/deps/jq-helpers/lib/jq_stack4.lib.sh"

#. "$basedir/deps/jq-helpers/lib/jq_stack4compat3.lib.sh"
#. "$basedir/deps/jq-helpers/lib/jq_run3.lib.sh"
#jq_stack() { jq_stack4 "$@"; }
#jq_run() { jq_stack4 :init :with external :else external "$@" :run :deinit; }

#. "$basedir/lib/hide_last_array_index.jq.lib.sh"
#. "$basedir/lib/json2flat.jq.lib.sh"
#. "$basedir/lib/json2ndjson.jq.lib.sh"
#. "$basedir/lib/ndjson2json.jq.lib.sh"
#. "$basedir/lib/sortallarrays.jq.lib.sh"

json_flat_sorted() {
	jq_stack4 :with external
	jq_stack4 $([ "$1" != "-s" ] || echo :modcall ndjson2json) :modcall json2flat :modcall hide_last_array_index :modcall sortallarrays :modcall json2ndjson
	jq_stack4 :run
}

. "$basedir/lib/jsondiff.lib.sh"

jsondiff "$@"
